<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XSS Lab: The Hidden Attribute</title>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
</head>
<body style="font-family: sans-serif; background: #ececec; padding: 20px;">

    <div style="max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2>CTF Level: Attribute Escape</h2>
        <p>Goal: Steal the Admin's cookie (the flag).</p>
        
        <div id="status" style="color: red; font-weight: bold;"></div>
        
        <input type="text" id="userInput" placeholder="Enter your name..." style="width: 80%; padding: 10px;">
        <button onclick="submitData()" style="padding: 10px;">Submit</button>

        <hr>
        <h3>Recent Visitors (Hover to see names)</h3>
        <div id="visitor-list"></div>
    </div>

    <script>
        // PASTE YOUR CONFIG HERE
        const firebaseConfig = {
            apiKey: "...",
            authDomain: "...",
            databaseURL: "...",
            projectId: "...",
            storageBucket: "...",
            messagingSenderId: "...",
            appId: "..."
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // SIMULATING THE FLAG (This is what players want to steal)
        document.cookie = "flag=CTF{FIREBASE_ATTR_BYPASS_2026}; path=/; SameSite=Lax";

        function submitData() {
            const input = document.getElementById('userInput').value;
            // BLACKLIST FILTER: Deletes <script> tags
            const filtered = input.replace(/<script>/gi, "[BLOCKED]");
            db.ref('visitors').push({ name: filtered });
            document.getElementById('userInput').value = "";
        }

        // VULNERABLE RENDERER
        db.ref('visitors').on('child_added', (snapshot) => {
            const data = snapshot.val();
            const container = document.getElementById('visitor-list');
            
            // TRICKY PART: The input is placed inside the 'title' attribute.
            // Players must use " to break out.
            const newEntry = document.createElement('div');
            newEntry.innerHTML = `
                <div style="padding: 10px; border-bottom: 1px solid #eee;">
                    <span title="${data.name}" style="color: blue; cursor: help;"> 
                        [?] Hover to view visitor 
                    </span>
                </div>`;
            container.appendChild(newEntry);
        });
    </script>
</body>
</html>